<div class="flex flex-col h-screen bg-slate-900 text-neutral-200">
    <header class="flex items-center justify-between h-14 bg-[#1a202c] px-4 border-b border-neutral-700 flex-shrink-0">
      <div class="flex items-center">
        <button (click)="toggleSidebar()" class="p-2 rounded-full hover:bg-neutral-700/50 transition-colors">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>
        </button>
        <span class="font-bold text-lg ml-3 bg-gradient-to-r from-sky-400 to-indigo-500 text-transparent bg-clip-text">
          iTask
        </span>
      </div>
  
      <div class="flex-1 flex justify-center px-4">
        <input
          type="text"
          placeholder="Search"
          class="w-full max-w-md bg-slate-800/60 px-4 py-1.5 text-sm text-neutral-200 placeholder:text-neutral-500 rounded-lg border border-neutral-700 focus:ring-2 focus:ring-sky-500 focus:border-sky-500 outline-none transition"
        />
      </div>
  
      <div class="flex items-center space-x-3">
        <div class="w-9 h-9 rounded-full bg-sky-500 flex items-center justify-center text-white text-sm font-bold ring-2 ring-offset-2 ring-offset-slate-900 ring-sky-500">
          {{ userInitial }}
        </div>
      </div>
    </header>
  
    <div class="flex flex-1 overflow-hidden">
      <aside 
        class="bg-[#1a202c] p-4 border-r border-neutral-700 flex-shrink-0 transition-all duration-300 ease-in-out overflow-hidden"
        [class.w-64]="!isSidebarCollapsed"
        [class.w-0]="isSidebarCollapsed"
        [class.p-4]="!isSidebarCollapsed"
        [class.p-0]="isSidebarCollapsed"
      >
        <nav class="space-y-2 whitespace-nowrap">
          <a routerLink="/dashboard" routerLinkActive="bg-sky-500/20 text-sky-400" [routerLinkActiveOptions]="{exact: true}" class="flex items-center gap-3 px-3 py-2 rounded-md hover:bg-neutral-700/50 transition-colors">Dashboard</a>
          <a routerLink="/users" routerLinkActive="bg-sky-500/20 text-sky-400" class="flex items-center gap-3 px-3 py-2 rounded-md hover:bg-neutral-700/50 transition-colors">Users</a>
          <div class="relative">
            <button
              (click)="toggleProjects()"
              class="flex items-center justify-between w-full px-2 py-2 rounded hover:bg-neutral-700"
            >
              <span class="flex items-center gap-2">
                <lucide-icon name="Folder" size="16"></lucide-icon>
                Projects
              </span>
              <lucide-icon
                [name]="projectsExpanded ? 'ChevronUp' : 'ChevronDown'"
                size="16"
              ></lucide-icon>
            </button>
            <div *ngIf="projectsExpanded" class="pl-6 mt-2 space-y-1">
              <ng-container *ngIf="projects.length > 0; else noProjects">
                <a
                  *ngFor="let project of projects"
                  [routerLink]="['/projects', project.id, 'dashboard']"
                  routerLinkActive="is-active"
                  [routerLinkActiveOptions]="{ exact: true }"
                  #rla="routerLinkActive"
                  class="group relative flex items-center rounded-md px-3 py-2 text-sm transition-colors"
                  [ngClass]="{
                    'text-sky-500 bg-sky-500/10 hover:bg-sky-500/15': rla.isActive,
                    'text-neutral-300 hover:text-neutral-50 hover:bg-neutral-800/60': !rla.isActive
                  }"
                  [attr.aria-current]="rla.isActive ? 'page' : null"
                >
                  <span
                    class="pointer-events-none absolute left-0 top-1/2 -translate-y-1/2 h-4 w-1 rounded-r transition-opacity"
                    [ngClass]="{
                      'bg-sky-500 opacity-100': rla.isActive,
                      'bg-neutral-500/60 opacity-0 group-hover:opacity-60': !rla.isActive
                    }"
                    aria-hidden="true"
                  ></span>
                  <span class="truncate">{{ project.name }}</span>
                </a>
              </ng-container>
   
              <ng-template #noProjects>
                <div
                  *ngIf="userRole === 'manager' || userRole === 'admin'"
                  class="text-sm text-neutral-400"
                >
                  No projects yet.
                  <button class="text-sky-500 hover:underline mt-1 block" (click)="createProject()">
                    + Create Project
                  </button>
                </div>
                <div *ngIf="userRole === 'user'" class="text-sm text-neutral-400">
                  You haven't been added to any projects yet.
                </div>
              </ng-template>
            </div>
          </div>
        </nav>
      </aside>
  
      <main class="flex-1 overflow-y-auto p-4 sm:p-6 lg:p-8">
        <router-outlet></router-outlet>
      </main>
    </div>
  </div>